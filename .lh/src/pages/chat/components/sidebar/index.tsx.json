{
    "sourceFile": "src/pages/chat/components/sidebar/index.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1740155273135,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1740155281325,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n } from \"./styles\";\n import { useContext, useEffect, useState, useCallback } from \"react\";\n import { InputContext } from \"../../../../pages/chat/context/filter\";\n import StatusMessage from \"../status-message\";\n-import { StateMessageContext } from \"pages/chat/context/filterState\";\n+import { StateMessageContext } from \"../../../../pages/chat/context/filterState\";\n import { SelectCustom } from \"pages/chat/chat-room-page/components/select-custom\";\n import useIsDesktop from \"pages/chat/hooks/useWindowSize\";\n import { usePhoneNumberWithLoader } from \"services/phone-number/getPhoneNumber.service\";\n import Icon from \"common/components/icons\";\n"
                },
                {
                    "date": 1740155287572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,9 @@\n import { useContext, useEffect, useState, useCallback } from \"react\";\n import { InputContext } from \"../../../../pages/chat/context/filter\";\n import StatusMessage from \"../status-message\";\n import { StateMessageContext } from \"../../../../pages/chat/context/filterState\";\n-import { SelectCustom } from \"pages/chat/chat-room-page/components/select-custom\";\n+import { SelectCustom } from \"../../../../pages/chat/chat-room-page/components/select-custom\";\n import useIsDesktop from \"pages/chat/hooks/useWindowSize\";\n import { usePhoneNumberWithLoader } from \"services/phone-number/getPhoneNumber.service\";\n import Icon from \"common/components/icons\";\n import ContactNewForm from \"../contact-new\";\n"
                },
                {
                    "date": 1740155293131,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,9 @@\n import { InputContext } from \"../../../../pages/chat/context/filter\";\n import StatusMessage from \"../status-message\";\n import { StateMessageContext } from \"../../../../pages/chat/context/filterState\";\n import { SelectCustom } from \"../../../../pages/chat/chat-room-page/components/select-custom\";\n-import useIsDesktop from \"pages/chat/hooks/useWindowSize\";\n+import useIsDesktop from \"../../../../pages/chat/hooks/useWindowSize\";\n import { usePhoneNumberWithLoader } from \"services/phone-number/getPhoneNumber.service\";\n import Icon from \"common/components/icons\";\n import ContactNewForm from \"../contact-new\";\n \n"
                },
                {
                    "date": 1740155299935,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n import StatusMessage from \"../status-message\";\n import { StateMessageContext } from \"../../../../pages/chat/context/filterState\";\n import { SelectCustom } from \"../../../../pages/chat/chat-room-page/components/select-custom\";\n import useIsDesktop from \"../../../../pages/chat/hooks/useWindowSize\";\n-import { usePhoneNumberWithLoader } from \"services/phone-number/getPhoneNumber.service\";\n+import { usePhoneNumberWithLoader } from \"../../../services/phone-number/getPhoneNumber.service\";\n import Icon from \"common/components/icons\";\n import ContactNewForm from \"../contact-new\";\n \n export default function Sidebar() {\n"
                },
                {
                    "date": 1740155306087,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,10 +22,10 @@\n import StatusMessage from \"../status-message\";\n import { StateMessageContext } from \"../../../../pages/chat/context/filterState\";\n import { SelectCustom } from \"../../../../pages/chat/chat-room-page/components/select-custom\";\n import useIsDesktop from \"../../../../pages/chat/hooks/useWindowSize\";\n-import { usePhoneNumberWithLoader } from \"../../../services/phone-number/getPhoneNumber.service\";\n-import Icon from \"common/components/icons\";\n+import { usePhoneNumberWithLoader } from \"../../../../services/phone-number/getPhoneNumber.service\";\n+import Icon from \"../common/components/icons\";\n import ContactNewForm from \"../contact-new\";\n \n export default function Sidebar() {\n   const chatCtx = useChatContext();\n"
                },
                {
                    "date": 1740155319637,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n import InboxContact from \"./contacts\";\n import OptionsMenu from \"../option-menu\";\n import SearchField from \"../search-field\";\n import { useAppTheme } from \"common/theme\";\n-import { InboxChat } from \"common/types/common.type\";\n+import { InboxChat } from \"../../../../common/types/common.type\";\n import { useChatContext } from \"pages/chat/context/chat\";\n import {\n   Actions,\n   Avatar,\n@@ -23,9 +23,9 @@\n import { StateMessageContext } from \"../../../../pages/chat/context/filterState\";\n import { SelectCustom } from \"../../../../pages/chat/chat-room-page/components/select-custom\";\n import useIsDesktop from \"../../../../pages/chat/hooks/useWindowSize\";\n import { usePhoneNumberWithLoader } from \"../../../../services/phone-number/getPhoneNumber.service\";\n-import Icon from \"../common/components/icons\";\n+import Icon from \"../../../../common/components/icons\";\n import ContactNewForm from \"../contact-new\";\n \n export default function Sidebar() {\n   const chatCtx = useChatContext();\n"
                },
                {
                    "date": 1740155326252,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { BsFillMoonFill, BsMoon } from \"react-icons/bs\";\n import InboxContact from \"./contacts\";\n import OptionsMenu from \"../option-menu\";\n import SearchField from \"../search-field\";\n-import { useAppTheme } from \"../../common/theme\";\n+import { useAppTheme } from \"../../.common/theme\";\n import { InboxChat } from \"../../../../common/types/common.type\";\n import { useChatContext } from \"pages/chat/context/chat\";\n import {\n   Actions,\n"
                }
            ],
            "date": 1740155273135,
            "name": "Commit-0",
            "content": "import { useLocation, useNavigate } from \"react-router-dom\";\nimport { parse, isValid } from 'date-fns';\nimport { BsFillMoonFill, BsMoon } from \"react-icons/bs\";\nimport InboxContact from \"./contacts\";\nimport OptionsMenu from \"../option-menu\";\nimport SearchField from \"../search-field\";\nimport { useAppTheme } from \"common/theme\";\nimport { InboxChat } from \"common/types/common.type\";\nimport { useChatContext } from \"pages/chat/context/chat\";\nimport {\n  Actions,\n  Avatar,\n  ContactContainer,\n  Header,\n  ImageWrapper,\n  InboxFilter,\n  SidebarContainer,\n  ThemeIconContainer,\n} from \"./styles\";\nimport { useContext, useEffect, useState, useCallback } from \"react\";\nimport { InputContext } from \"../../../../pages/chat/context/filter\";\nimport StatusMessage from \"../status-message\";\nimport { StateMessageContext } from \"pages/chat/context/filterState\";\nimport { SelectCustom } from \"pages/chat/chat-room-page/components/select-custom\";\nimport useIsDesktop from \"pages/chat/hooks/useWindowSize\";\nimport { usePhoneNumberWithLoader } from \"services/phone-number/getPhoneNumber.service\";\nimport Icon from \"common/components/icons\";\nimport ContactNewForm from \"../contact-new\";\n\nexport default function Sidebar() {\n  const chatCtx = useChatContext();\n  const location = useLocation();\n\n  const context = useContext(InputContext);\n  const contextState = useContext(StateMessageContext);\n  const isDesktop = useIsDesktop();\n  const [changeRoute, setChangeRoute] = useState('')\n  const { showNewContactModal, setShowNewContactModal } = useChatContext();\n\n  useEffect(() => {\n    setChangeRoute(location.pathname)\n  }, [chatCtx.chatSelected, location]);\n\n  if (!context || !contextState) {\n    throw new Error(\"Sidebar debe estar dentro de un InputProvider\");\n  }\n\n  const { inputValue } = context;\n  const { state } = contextState;\n  \n  const theme = useAppTheme();\n  const navigate = useNavigate();\n\n  const [filteredContacts, setFilteredContacts] = useState<InboxChat[]>([]);\n  const [filteredChats, setFilteredChats] = useState<InboxChat[]>([]);\n  const { putChangeStatusMessage } = usePhoneNumberWithLoader();\n\n  const handleChangeThemeMode = () => {\n    theme.onChangeThemeMode();\n  };\n\n  const handleChangeChat = (\n    async (chat: InboxChat) => {\n      if (chat.countMessages > 0) {\n        try {\n          await putChangeStatusMessage(\n            { phoneNumberId: chat.from },\n            chat.phone\n        );\n          \n        } catch (error) {\n          \n        }\n      }\n      \n      chatCtx.setShowModal(false);\n      \n      if (inputValue !== '') {\n        chatCtx.setChatSelected(chat);\n      } else {\n        chatCtx.setChatSelected(null);\n      }\n      \n      chatCtx.onChangeChat(chat);\n      navigate(\"/\" + (chat.phone || chat.to));\n    }\n  );\n\n  const sortChatData = (data: any[]) => {\n    if (data.length === 0) return data;\n  \n    const DataFilter = data.filter((a) => a.updatedAt )\n    \n    return DataFilter.sort((a, b) => {\n      const dateA = parse(a.updatedAt, 'dd/MM/yyyy hh:mm a', new Date());\n          const dateB = parse(b.updatedAt, 'dd/MM/yyyy hh:mm a', new Date());\n  \n          if (!isValid(dateA) || !isValid(dateB)) {\n            console.error('Invalid date:', a.updatedAt, b.updatedAt);\n            return 0;\n          }\n  \n          return  dateB.getTime() - dateA.getTime();\n    });\n  };\n\n  const filterChatsRoot = () => {\n    if (!inputValue && state === \"all\") return sortChatData(chatCtx.data)\n\n    if (!inputValue && state === \"not_confirmed\") return sortChatData(chatCtx?.data?.filter((chat: InboxChat) => !chat.isConfirmed));\n\n    if (!inputValue && state === \"confirmed\") return sortChatData(chatCtx?.data?.filter((chat: InboxChat) => chat.isConfirmed && chat.isConfirmed === true));\n    \n    return sortChatData(chatCtx?.data?.filter((chat: InboxChat) => chat.status === state));\n  }\n\n  const filterChats = useCallback(() => {\n    if (!inputValue && state === \"all\") {\n      return chatCtx.data;\n    }\n    \n    return  chatCtx?.data\n      ?.map((chat: InboxChat) => {\n        if (!chat.messages) return; \n        \n        const filteredMessages = Object.entries(chat.messages)\n          .filter(([_, msg]) => {\n            const matchesLocation = msg.type === \"location\" && (msg.text && \n              msg.text.toLowerCase().includes(inputValue.toLowerCase()) )\n            \n            const matchesTemplate = \n              msg.type === \"template\" && \n                (msg.data?.address && \n                msg.data?.address.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.company && \n                msg.data?.company.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.customer && \n                msg.data?.customer.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.department && \n                msg.data?.department.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.district && \n                msg.data?.district.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.note && \n                msg.data?.note.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.orderNumber && \n                msg.data?.orderNumber.toLowerCase().includes(inputValue.toLowerCase()) || \n                msg.data?.products && \n                msg.data?.products.toLowerCase().includes(inputValue.toLowerCase()) ||\n                msg.data?.total && \n                msg.data?.total.toString().toLowerCase().includes(inputValue.toLowerCase())\n              );\n            \n            const matchesNickname = \n              msg.nickname && \n              msg.nickname.toLowerCase().includes(inputValue.toLowerCase());\n\n            const matchesText = \n              msg.type === \"text\" && \n              msg.text && \n              msg.text.toLowerCase().includes(inputValue.toLowerCase());\n\n            const matchesContent = \n              msg.type === \"text\" && \n              msg.content && \n              msg.content.toLowerCase().includes(inputValue.toLowerCase());\n\n            const matchesState = state === \"not_confirmed\" ? !msg.isConfirmed : \n              state === \"confirmed\" ? msg.isConfirmed && msg.isConfirmed === true : \n              state === \"all\" ? state === \"all\" : msg.status === state\n\n            return (matchesText || matchesContent || matchesTemplate || matchesLocation || matchesNickname) && matchesState;\n          })\n          .reduce((acc, [key, value]) => {\n            acc[key] = value;\n            return acc;\n          }, {});\n  \n        if (Object.keys(filteredMessages).length > 0) {\n          return {\n            ...chat,\n            messages: filteredMessages,\n          };\n        }\n        return null;\n      })\n      .filter(Boolean);\n    \n  }, [inputValue, chatCtx.data, state]);\n\n  const openNewContact = () => {\n    setShowNewContactModal(true)\n  }\n\n  const filterContacts = useCallback(() => {\n    if (!inputValue) {\n      return sortChatData(chatCtx.data);\n    }\n    const filtered = chatCtx.data?.filter((msg) => msg?.phone?.toLowerCase().includes(inputValue.toLowerCase()))\n\n    if (state === \"not_confirmed\") return sortChatData(filtered.filter( (msg) => !msg.isConfirmed))\n\n    if (state === \"confirmed\") return sortChatData(filtered.filter( (msg) => msg.isConfirmed && msg.isConfirmed === true))\n\n    if (state !== \"all\") {\n      return sortChatData(filtered.filter( (msg) => msg.status === state))\n    }\n\n    return sortChatData(filtered)\n  }, [inputValue, chatCtx.data, state]);\n\n  useEffect(() => {\n    const filtered = filterChats();\n    const filteredContacts = filterContacts();\n    \n    setFilteredContacts(filteredContacts);\n    setFilteredChats(filtered);\n  }, [filterChats, filterContacts]);\n  \n  return (\n    <SidebarContainer \n    style={{zIndex: isDesktop ? '' : changeRoute === \"/\" ? '-1' : '9999'  }}\n    \n    className={isDesktop ? '' : 'isMobile'}>\n      <Header>\n        <ImageWrapper>\n          <Avatar src=\"/assets/logo.png\" /> \n        </ImageWrapper>\n        <Actions>\n          <ThemeIconContainer onClick={handleChangeThemeMode}>\n            {theme.mode === \"light\" ? <BsMoon /> : <BsFillMoonFill />}\n          </ThemeIconContainer>\n\n          <button aria-label=\"New chat\" onClick={() => openNewContact()}>\n            <Icon id=\"addPlus\" className=\"icon\" />\n          </button>\n\n          <ContactNewForm \n            onClose={() => setShowNewContactModal(false)}\n            isOpen={showNewContactModal}\n          />\n\n          <OptionsMenu\n            iconClassName=\"icon\"\n            className=\"icon\"\n            ariaLabel=\"Menu\"\n            iconId=\"menu\"\n            options={[\"Cerrar sesiÃ³n\"]}\n          />\n        </Actions>\n      </Header>\n\n      <SearchField />\n\n      <StatusMessage />\n      \n      <SelectCustom />\n\n      <ContactContainer>\n        {\n          inputValue === '' \n          ?\n          filterChatsRoot()\n          .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())\n          .filter( (user: any) => user.phone )\n          .map((inbox) => (\n            <>\n            <InboxContact\n              key={inbox.phone}\n              inbox={inbox}\n              isActive={inbox.phone === chatCtx.activeChat?.phone}\n              onChangeChat={handleChangeChat}\n            />\n            </>\n          ))\n          :\n          filteredContacts\n        }\n      </ContactContainer>\n    </SidebarContainer>\n  );\n}\n"
        }
    ]
}